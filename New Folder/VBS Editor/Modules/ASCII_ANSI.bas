Attribute VB_Name = "ASCII_ANSI_Convert"
Private ASCII(0 To 255) As Byte
Private ANSI(0 To 255) As Byte

Public Enum ASCII_ANSI_CONVERT_DIRECTION
    ASCII_TO_ANSI = 1
    ANSI_TO_ASCII = 2
End Enum

Private Declare Function OemToCharA Lib "user32.dll" (ByVal lpszSrc As String, ByVal lpszDst As String) As Long
        
Private Declare Function CharToOemA Lib "user32.dll" (ByVal lpszSrc As String, ByVal lpszDst As String) As Long

Private ANSI127(127 To 255) As String

Function StrToANSI127_Remove(ByVal Text As String) As String
Dim i As Long
Dim b() As Byte
Dim sOut As New CStrCat


b = StrConv(Text, vbFromUnicode)
sOut.MaxLength = Len(Text)

For i = LBound(b) To UBound(b)
    If b(i) < 127 Then
        sOut.AddStr Chr$(b(i))
    End If
Next

StrToANSI127_Remove = sOut.StrVal

End Function
Function StrToANSI127(ByVal Text As String) As String
Dim i As Long
Dim b() As Byte
Dim sOut As New CStrCat

InitANSI_127

b = StrConv(Text, vbFromUnicode)
sOut.MaxLength = Len(Text) + Len(Text) \ 10  ' arbitrary addition
                                             'just in case!

For i = LBound(b) To UBound(b)
    If b(i) >= 127 Then
        sOut.AddStr ANSI127(b(i))
    Else
        sOut.AddStr Chr$(b(i))
    End If
Next


StrToANSI127 = sOut.StrVal


End Function

Private Sub InitANSI_127()
Dim idx As Integer
If ANSI127(131) <> "" Then Exit Sub  ' already initialized

'''''''''''''''''''''''''''''
' 127 -->  255
'''''''''''''''''''''''''''''
ANSI127(127) = ""
ANSI127(128) = "euro"
ANSI127(129) = ""
ANSI127(130) = "'"
ANSI127(131) = "f"
ANSI127(132) = """"
ANSI127(133) = "..."
ANSI127(134) = ""
ANSI127(135) = ""
ANSI127(136) = "^"
ANSI127(137) = "0/00"  'per 1000
ANSI127(138) = "S"
ANSI127(139) = "<"
ANSI127(140) = "OE"
ANSI127(141) = ""
ANSI127(142) = "Z"
ANSI127(143) = ""
ANSI127(144) = ""
ANSI127(145) = "`"  ' OR "'"
ANSI127(146) = "'"
ANSI127(147) = """"
ANSI127(148) = """"
ANSI127(149) = "*"
ANSI127(150) = "-"
ANSI127(151) = "-"
ANSI127(152) = "~"
ANSI127(153) = "(tm)"
ANSI127(154) = "s"
ANSI127(155) = ">"
ANSI127(156) = "oe"
ANSI127(157) = ""
ANSI127(158) = "z"
ANSI127(159) = "Y"
ANSI127(160) = " "
ANSI127(161) = "!"
ANSI127(162) = "cent"
ANSI127(163) = "pound"
ANSI127(164) = ""
ANSI127(165) = "yen"
ANSI127(166) = "|"
ANSI127(167) = ""
ANSI127(168) = ""
ANSI127(169) = "(C)"
ANSI127(170) = "a"
ANSI127(171) = """"
ANSI127(172) = "-"
ANSI127(173) = ""
ANSI127(174) = "(R)"
ANSI127(175) = " "
ANSI127(176) = "deg"
ANSI127(177) = "+/-"
ANSI127(178) = "^2"
ANSI127(179) = "^3"
ANSI127(180) = "'"
ANSI127(181) = "micro"
ANSI127(182) = ""
ANSI127(183) = "."
ANSI127(184) = " "
ANSI127(185) = "^1"
ANSI127(186) = "o"
ANSI127(187) = """"
ANSI127(188) = "1/4"
ANSI127(189) = "1/2"
ANSI127(190) = "3/4"
ANSI127(191) = "?"
ANSI127(192) = "A"
ANSI127(193) = "A"
ANSI127(194) = "A"
ANSI127(195) = "A"
ANSI127(196) = "A"
ANSI127(197) = "A"
ANSI127(198) = "AE"
ANSI127(199) = "C"
ANSI127(200) = "E"
ANSI127(201) = "E"
ANSI127(202) = "E"
ANSI127(203) = "E"
ANSI127(204) = "I"
ANSI127(205) = "I"
ANSI127(206) = "I"
ANSI127(207) = "I"
ANSI127(208) = ""
ANSI127(209) = "N"
ANSI127(210) = "O"
ANSI127(211) = "O"
ANSI127(212) = "O"
ANSI127(213) = "O"
ANSI127(214) = "O"
ANSI127(215) = "*"
ANSI127(216) = "O"
ANSI127(217) = "U"
ANSI127(218) = "U"
ANSI127(219) = "U"
ANSI127(220) = "U"
ANSI127(221) = "Y"
ANSI127(222) = ""
ANSI127(223) = ""
ANSI127(224) = "a"
ANSI127(225) = "a"
ANSI127(226) = "a"
ANSI127(227) = "a"
ANSI127(228) = "a"
ANSI127(229) = "a"
ANSI127(230) = "a"
ANSI127(231) = "c"
ANSI127(232) = "e"
ANSI127(233) = "e"
ANSI127(234) = "e"
ANSI127(235) = "e"
ANSI127(236) = "i"
ANSI127(237) = "i"
ANSI127(238) = "i"
ANSI127(239) = "i"
ANSI127(240) = ""
ANSI127(241) = "n"
ANSI127(242) = "o"
ANSI127(243) = "o"
ANSI127(244) = "o"
ANSI127(245) = "o"
ANSI127(246) = "o"
ANSI127(247) = "/"
ANSI127(248) = "o"
ANSI127(249) = "u"
ANSI127(250) = "u"
ANSI127(251) = "u"
ANSI127(252) = "u"
ANSI127(253) = "y"
ANSI127(254) = ""
ANSI127(255) = "y"

End Sub

Public Function ASCIItoANSI_API(ByVal Text As String) As String
  Call OemToCharA(Text, Text)
  ASCIItoANSI_API = Text
End Function

Public Function ANSItoASCII_API(ByVal Text As String) As String
  Call CharToOemA(Text, Text)
  ANSItoASCII_API = Text
End Function

Private Function ASCIItoANSI(ByVal c As Byte)

    ASCIItoANSI = ASCII(c)

End Function
Private Function ANSItoASCII(ByVal c As Byte)

    ANSItoASCII = ANSI(c)

End Function

Function ConvertStr(ByVal Text As String, ByVal ConvertDirection As ASCII_ANSI_CONVERT_DIRECTION) As String
Dim i As Long
Dim b() As Byte

InitTables

b = StrConv(Text, vbFromUnicode)

For i = LBound(b) To UBound(b)

    If ConvertDirection = ANSI_TO_ASCII Then
        b(i) = ANSItoASCII(b(i))
    Else
        b(i) = ASCIItoANSI(b(i))
    End If

Next

ConvertStr = StrConv(b, vbUnicode)

End Function

Private Sub InitTables()

ASCII(0) = 0
ASCII(1) = 1
ASCII(2) = 2
ASCII(3) = 3
ASCII(4) = 4
ASCII(5) = 5
ASCII(6) = 6
ASCII(7) = 7
ASCII(8) = 8
ASCII(9) = 9
ASCII(10) = 10
ASCII(11) = 11
ASCII(12) = 12
ASCII(13) = 13
ASCII(14) = 14
ASCII(15) = 15
ASCII(16) = 16
ASCII(17) = 17
ASCII(18) = 18
ASCII(19) = 19
ASCII(20) = 20
ASCII(21) = 21
ASCII(22) = 22
ASCII(23) = 23
ASCII(24) = 24
ASCII(25) = 25
ASCII(26) = 26
ASCII(27) = 27
ASCII(28) = 28
ASCII(29) = 29
ASCII(30) = 30
ASCII(31) = 31
ASCII(32) = 32
ASCII(33) = 33
ASCII(34) = 34
ASCII(35) = 35
ASCII(36) = 36
ASCII(37) = 37
ASCII(38) = 38
ASCII(39) = 39
ASCII(40) = 40
ASCII(41) = 41
ASCII(42) = 42
ASCII(43) = 43
ASCII(44) = 44
ASCII(45) = 45
ASCII(46) = 46
ASCII(47) = 47
ASCII(48) = 48
ASCII(49) = 49
ASCII(50) = 50
ASCII(51) = 51
ASCII(52) = 52
ASCII(53) = 53
ASCII(54) = 54
ASCII(55) = 55
ASCII(56) = 56
ASCII(57) = 57
ASCII(58) = 58
ASCII(59) = 59
ASCII(60) = 60
ASCII(61) = 61
ASCII(62) = 62
ASCII(63) = 63
ASCII(64) = 64
ASCII(65) = 65
ASCII(66) = 66
ASCII(67) = 67
ASCII(68) = 68
ASCII(69) = 69
ASCII(70) = 70
ASCII(71) = 71
ASCII(72) = 72
ASCII(73) = 73
ASCII(74) = 74
ASCII(75) = 75
ASCII(76) = 76
ASCII(77) = 77
ASCII(78) = 78
ASCII(79) = 79
ASCII(80) = 80
ASCII(81) = 81
ASCII(82) = 82
ASCII(83) = 83
ASCII(84) = 84
ASCII(85) = 85
ASCII(86) = 86
ASCII(87) = 87
ASCII(88) = 88
ASCII(89) = 89
ASCII(90) = 90
ASCII(91) = 91
ASCII(92) = 92
ASCII(93) = 93
ASCII(94) = 94
ASCII(95) = 95
ASCII(96) = 96
ASCII(97) = 97
ASCII(98) = 98
ASCII(99) = 99
ASCII(100) = 100
ASCII(101) = 101
ASCII(102) = 102
ASCII(103) = 103
ASCII(104) = 104
ASCII(105) = 105
ASCII(106) = 106
ASCII(107) = 107
ASCII(108) = 108
ASCII(109) = 109
ASCII(110) = 110
ASCII(111) = 111
ASCII(112) = 112
ASCII(113) = 113
ASCII(114) = 114
ASCII(115) = 115
ASCII(116) = 116
ASCII(117) = 117
ASCII(118) = 118
ASCII(119) = 119
ASCII(120) = 120
ASCII(121) = 121
ASCII(122) = 122
ASCII(123) = 123
ASCII(124) = 124
ASCII(125) = 125
ASCII(126) = 126
ASCII(127) = 127
ASCII(128) = 199
ASCII(129) = 252
ASCII(130) = 233
ASCII(131) = 226
ASCII(132) = 228
ASCII(133) = 224
ASCII(134) = 229
ASCII(135) = 231
ASCII(136) = 234
ASCII(137) = 235
ASCII(138) = 232
ASCII(139) = 239
ASCII(140) = 238
ASCII(141) = 236
ASCII(142) = 196
ASCII(143) = 197
ASCII(144) = 201
ASCII(145) = 230
ASCII(146) = 198
ASCII(147) = 244
ASCII(148) = 246
ASCII(149) = 242
ASCII(150) = 251
ASCII(151) = 249
ASCII(152) = 255
ASCII(153) = 214
ASCII(154) = 220
ASCII(155) = 248
ASCII(156) = 163
ASCII(157) = 216
ASCII(158) = 215
ASCII(159) = 131
ASCII(160) = 225
ASCII(161) = 237
ASCII(162) = 243
ASCII(163) = 250
ASCII(164) = 241
ASCII(165) = 209
ASCII(166) = 170
ASCII(167) = 186
ASCII(168) = 191
ASCII(169) = 174
ASCII(170) = 172
ASCII(171) = 189
ASCII(172) = 188
ASCII(173) = 161
ASCII(174) = 171
ASCII(175) = 187
ASCII(176) = 176
ASCII(177) = 177
ASCII(178) = 178
ASCII(179) = 179
ASCII(180) = 180
ASCII(181) = 193
ASCII(182) = 194
ASCII(183) = 192
ASCII(184) = 169
ASCII(185) = 185
ASCII(186) = 186
ASCII(187) = 187
ASCII(188) = 188
ASCII(189) = 162
ASCII(190) = 165
ASCII(191) = 191
ASCII(192) = 192
ASCII(193) = 193
ASCII(194) = 194
ASCII(195) = 195
ASCII(196) = 196
ASCII(197) = 134
ASCII(198) = 227
ASCII(199) = 195
ASCII(200) = 200
ASCII(201) = 201
ASCII(202) = 202
ASCII(203) = 203
ASCII(204) = 204
ASCII(205) = 205
ASCII(206) = 135
ASCII(207) = 164
ASCII(208) = 240
ASCII(209) = 208
ASCII(210) = 202
ASCII(211) = 203
ASCII(212) = 200
ASCII(213) = 213
ASCII(214) = 205
ASCII(215) = 206
ASCII(216) = 207
ASCII(217) = 217
ASCII(218) = 218
ASCII(219) = 219
ASCII(220) = 220
ASCII(221) = 166
ASCII(222) = 204
ASCII(223) = 223
ASCII(224) = 211
ASCII(225) = 223
ASCII(226) = 212
ASCII(227) = 210
ASCII(228) = 245
ASCII(229) = 213
ASCII(230) = 181
ASCII(231) = 254
ASCII(232) = 222
ASCII(233) = 218
ASCII(234) = 219
ASCII(235) = 217
ASCII(236) = 253
ASCII(237) = 221
ASCII(238) = 175
ASCII(239) = 180
ASCII(240) = 173
ASCII(241) = 177
ASCII(242) = 242
ASCII(243) = 190
ASCII(244) = 182
ASCII(245) = 167
ASCII(246) = 247
ASCII(247) = 184
ASCII(248) = 176
ASCII(249) = 168
ASCII(250) = 183
ASCII(251) = 185
ASCII(252) = 179
ASCII(253) = 178
ASCII(254) = 254
ASCII(255) = 160
'''''''''''''''''''''''''''''''''
ANSI(0) = 0
ANSI(1) = 1
ANSI(2) = 2
ANSI(3) = 3
ANSI(4) = 4
ANSI(5) = 5
ANSI(6) = 6
ANSI(7) = 7
ANSI(8) = 8
ANSI(9) = 9
ANSI(10) = 10
ANSI(11) = 11
ANSI(12) = 12
ANSI(13) = 13
ANSI(14) = 14
ANSI(15) = 15
ANSI(16) = 16
ANSI(17) = 17
ANSI(18) = 18
ANSI(19) = 19
ANSI(20) = 20
ANSI(21) = 21
ANSI(22) = 22
ANSI(23) = 23
ANSI(24) = 24
ANSI(25) = 25
ANSI(26) = 26
ANSI(27) = 27
ANSI(28) = 28
ANSI(29) = 29
ANSI(30) = 30
ANSI(31) = 31
ANSI(32) = 32
ANSI(33) = 33
ANSI(34) = 34
ANSI(35) = 35
ANSI(36) = 36
ANSI(37) = 37
ANSI(38) = 38
ANSI(39) = 39
ANSI(40) = 40
ANSI(41) = 41
ANSI(42) = 42
ANSI(43) = 43
ANSI(44) = 44
ANSI(45) = 45
ANSI(46) = 46
ANSI(47) = 47
ANSI(48) = 48
ANSI(49) = 49
ANSI(50) = 50
ANSI(51) = 51
ANSI(52) = 52
ANSI(53) = 53
ANSI(54) = 54
ANSI(55) = 55
ANSI(56) = 56
ANSI(57) = 57
ANSI(58) = 58
ANSI(59) = 59
ANSI(60) = 60
ANSI(61) = 61
ANSI(62) = 62
ANSI(63) = 63
ANSI(64) = 64
ANSI(65) = 65
ANSI(66) = 66
ANSI(67) = 67
ANSI(68) = 68
ANSI(69) = 69
ANSI(70) = 70
ANSI(71) = 71
ANSI(72) = 72
ANSI(73) = 73
ANSI(74) = 74
ANSI(75) = 75
ANSI(76) = 76
ANSI(77) = 77
ANSI(78) = 78
ANSI(79) = 79
ANSI(80) = 80
ANSI(81) = 81
ANSI(82) = 82
ANSI(83) = 83
ANSI(84) = 84
ANSI(85) = 85
ANSI(86) = 86
ANSI(87) = 87
ANSI(88) = 88
ANSI(89) = 89
ANSI(90) = 90
ANSI(91) = 91
ANSI(92) = 92
ANSI(93) = 93
ANSI(94) = 94
ANSI(95) = 95
ANSI(96) = 96
ANSI(97) = 97
ANSI(98) = 98
ANSI(99) = 99
ANSI(100) = 100
ANSI(101) = 101
ANSI(102) = 102
ANSI(103) = 103
ANSI(104) = 104
ANSI(105) = 105
ANSI(106) = 106
ANSI(107) = 107
ANSI(108) = 108
ANSI(109) = 109
ANSI(110) = 110
ANSI(111) = 111
ANSI(112) = 112
ANSI(113) = 113
ANSI(114) = 114
ANSI(115) = 115
ANSI(116) = 116
ANSI(117) = 117
ANSI(118) = 118
ANSI(119) = 119
ANSI(120) = 120
ANSI(121) = 121
ANSI(122) = 122
ANSI(123) = 123
ANSI(124) = 124
ANSI(125) = 125
ANSI(126) = 126
ANSI(127) = 127
ANSI(128) = 63
ANSI(129) = 63
ANSI(130) = 39
ANSI(131) = 159
ANSI(132) = 34
ANSI(133) = 46
ANSI(134) = 197
ANSI(135) = 206
ANSI(136) = 94
ANSI(137) = 37
ANSI(138) = 83
ANSI(139) = 60
ANSI(140) = 79
ANSI(141) = 63
ANSI(142) = 90
ANSI(143) = 63
ANSI(144) = 63
ANSI(145) = 39
ANSI(146) = 39
ANSI(147) = 34
ANSI(148) = 34
ANSI(149) = 7
ANSI(150) = 45
ANSI(151) = 45
ANSI(152) = 126
ANSI(153) = 84
ANSI(154) = 115
ANSI(155) = 62
ANSI(156) = 111
ANSI(157) = 63
ANSI(158) = 122
ANSI(159) = 89
ANSI(160) = 255
ANSI(161) = 173
ANSI(162) = 189
ANSI(163) = 156
ANSI(164) = 207
ANSI(165) = 190
ANSI(166) = 221
ANSI(167) = 245
ANSI(168) = 249
ANSI(169) = 184
ANSI(170) = 166
ANSI(171) = 174
ANSI(172) = 170
ANSI(173) = 240
ANSI(174) = 169
ANSI(175) = 238
ANSI(176) = 248
ANSI(177) = 241
ANSI(178) = 253
ANSI(179) = 252
ANSI(180) = 239
ANSI(181) = 230
ANSI(182) = 244
ANSI(183) = 250
ANSI(184) = 247
ANSI(185) = 251
ANSI(186) = 167
ANSI(187) = 175
ANSI(188) = 172
ANSI(189) = 171
ANSI(190) = 243
ANSI(191) = 168
ANSI(192) = 183
ANSI(193) = 181
ANSI(194) = 182
ANSI(195) = 199
ANSI(196) = 142
ANSI(197) = 143
ANSI(198) = 146
ANSI(199) = 128
ANSI(200) = 212
ANSI(201) = 144
ANSI(202) = 210
ANSI(203) = 211
ANSI(204) = 222
ANSI(205) = 214
ANSI(206) = 215
ANSI(207) = 216
ANSI(208) = 209
ANSI(209) = 165
ANSI(210) = 227
ANSI(211) = 224
ANSI(212) = 226
ANSI(213) = 229
ANSI(214) = 153
ANSI(215) = 158
ANSI(216) = 157
ANSI(217) = 235
ANSI(218) = 233
ANSI(219) = 234
ANSI(220) = 154
ANSI(221) = 237
ANSI(222) = 232
ANSI(223) = 225
ANSI(224) = 133
ANSI(225) = 160
ANSI(226) = 131
ANSI(227) = 198
ANSI(228) = 132
ANSI(229) = 134
ANSI(230) = 145
ANSI(231) = 135
ANSI(232) = 138
ANSI(233) = 130
ANSI(234) = 136
ANSI(235) = 137
ANSI(236) = 141
ANSI(237) = 161
ANSI(238) = 140
ANSI(239) = 139
ANSI(240) = 208
ANSI(241) = 164
ANSI(242) = 149
ANSI(243) = 162
ANSI(244) = 147
ANSI(245) = 228
ANSI(246) = 148
ANSI(247) = 246
ANSI(248) = 155
ANSI(249) = 151
ANSI(250) = 163
ANSI(251) = 150
ANSI(252) = 129
ANSI(253) = 236
ANSI(254) = 231
ANSI(255) = 152


End Sub

